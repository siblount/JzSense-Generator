<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta http-equiv="expires" content="0">
<title>DAZ Script 2: Porting to DAZ Script 2</title>
<link href="docstyle.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<h1><a class="anchor" name="ds2porting">Porting to DAZ Script 2</a></h1>DAZ Script 1 is the scripting language available in DAZ Studio versions 1.x and 2.x. In DAZ Studio 3.x, the scripting language has changed and has been rebranded as DAZ Script 2. Some simple scripts written for DAZ Script 1 will still work in DAZ Script 2, however, many scripts will require minor changes, and some will require more significant changes in order to work.<p>
Included in DAZ Studio 3.x, is a conversion tool that automatically converts scripts saved from earlier versions of DAZ Studio to the DAZ Script 2 format/syntax. This tool was written with the goal of converting all the DAZ Script 1-based Presets that have been saved from earlier versions of DAZ Studio. This tool is also available to convert custom hand written scripts from earlier versions of DAZ Studio. Since we can not possibly anticipate all of the methods used when writing scripts, it is not realistic for us to provide a converter that is capable of handling every case, but it should serve as a solid first-step in converting scripts that you have written for earlier versions of the application.<p>
When you open a script written for a prior version of the application in the DAZ Script IDE in DAZ Studio 3.x, you will be presented with a message informing you that <em>"The selected script is in a deprecated format (*.ds). The contents of the script has been automatically converted to the new format and the file extension has been updated to reflect the conversion."</em> Upon clicking the OK button, the IDE will then automatically run the conversion and display the result in a new tab of the IDE; it does not modify your existing script file. Manual access to the converter function can be found on <a class="el" href="class_dz_script.html" title="Encapsulates a DAZ Script script.">DzScript</a>.<h2><a class="anchor" name="scriptChanged">
What has changed:</a></h2>
<ul>
<li>
<b>class:</b> The '<a class="el" href="ds2porting.html#scriptClass">class</a>' and '<em>extends</em>' keywords are no longer available; they are now simply <a class="el" href="dsidentifiers.html#keywords">reserved keywords</a>. </li>
<li>
<b>prototype:</b> The '<a class="el" href="ds2porting.html#scriptPrototype">prototype</a>' of an object is now available. </li>
<li>
<b>const:</b> The '<a class="el" href="ds2porting.html#scriptConst">const</a>' keyword is no longer supported. </li>
<li>
<b>static:</b> The '<a class="el" href="ds2porting.html#scriptStatic">static</a>' keyword is no longer available. </li>
</ul>
<h2><a class="anchor" name="scriptClass">
Class:</a></h2>
This is the most significant change between DAZ Script 1 to DAZ Script 2. There is no longer the syntax to declare classes and inherit (extend) other classes that was available in DAZ Script 1. In DAZ Script 2, object-oriented design methods can still be used, but the syntax is very different - the new method should be familiar to developers who have written JavaScript, though it may be a little unintuitive for developers more comfortable with C++ and Java style syntax.<p>
For example, in DAZ Script 1, a point class could be defined as: <div class="fragment"><pre class="fragment">    <span class="keyword">class </span>Point3
    {
        var x;
        var y;
        var z;
        function Point3( px, py, pz )
        {
            x = px;
            y = py;
            z = pz;
        }

        function toString()
        {
            <span class="keywordflow">return</span> <a class="code" href="class_string.html" title="ECMAScript String type.">String</a>( <span class="stringliteral">"Point3(%1, %2, %3)"</span> ).arg(x).arg(y).arg(z);
        }
    }
</pre></div><p>
In DAZ Script 2, you could represent the same point object as: <div class="fragment"><pre class="fragment">    function Point3( px, py, pz )
    {
        <span class="keyword">this</span>.x = px;
        <span class="keyword">this</span>.y = py;
        <span class="keyword">this</span>.z = pz;
    }

    Point3.prototype.toString = function()
    {
        <span class="keywordflow">return</span> <a class="code" href="class_string.html" title="ECMAScript String type.">String</a>( <span class="stringliteral">"Point3(%1, %2, %3)"</span> ).arg( <span class="keyword">this</span>.x ).arg( <span class="keyword">this</span>.y ).arg( <span class="keyword">this</span>.z );
    }
</pre></div><p>
In DAZ Script 2, everything is an object, including functions - so the function Point3 becomes our point object, and we assign the x, y, and z variables as properties on the Point3 object. Functions can also be assigned as properties, so we create a toString property on the Point3 object that is set to the function that creates the string.<p>
We can use our new Point3 object just as we would the Point3 class: <div class="fragment"><pre class="fragment">    var oPoint = <span class="keyword">new</span> Point3( 1, 2, 3 );

    <a class="code" href="group___globals.html#gfa67d3825f77e2cd3f25a403c3a95a18">debug</a>( oPoint );
</pre></div><h2><a class="anchor" name="scriptPrototype">
Prototype and Inheritance:</a></h2>
Prototypes are a part of the ECMAScript 3.0 specification that was not implemented in DAZ Script 1, but is available in DAZ Script 2. The purpose of a prototype object is to define the behavior that should be shared by a set of similar objects. We can think of objects that share the same prototype as being part of the same class; not to be confused with the class construct of languages like C++, Java and DAZ Script 1.<p>
When an attempt is made to access a property on an object and that object does not have the property, that attempt is then made on the prototype for the object; and if the prototype has the property then its value is returned. If the object's prototype doesn't have the property, the prototype's prototype is checked, and so on. This successive chain of objects is whats referred to as a prototype chain.<p>
Using the prototype of an object, we can make one object derive (or inherit) from another, much like using the 'extends' keyword in DAZ Script 1 to make a child class.<p>
In DAZ Script 1, we could create a Point4 class that extends the Point3 class with a new 'w' property: <div class="fragment"><pre class="fragment">    <span class="keyword">class </span>Point4 <span class="keyword">extends</span> Point3
    {
        var w;
        function Point4( px, py, pz, pw )
        {
            Point3( px, py, pz );
            w = pw;
        }

        function toString()
        {
            <span class="keywordflow">return</span> <a class="code" href="class_string.html" title="ECMAScript String type.">String</a>( <span class="stringliteral">"Point4(%1, %2, %3, %4)"</span> ).arg(x).arg(y).arg(z).arg(w);
        }
    }
</pre></div><p>
In DAZ Script 2, we can use the prototype to do the same thing: <div class="fragment"><pre class="fragment">    function Point4( px, py, pz, pw )
    {
        <a class="code" href="group___globals.html#gb874780a0213e19d9af91504e75f0cd0">arguments</a>.callee.superclass.call( <span class="keyword">this</span>, px, py, pz );
        <span class="keyword">this</span>.w = pw;
    }

    Point4.<a class="code" href="class_object.html#4448756a086efacffae2c453558280a9">prototype</a>.toString = function()
    {
        <span class="keywordflow">return</span> <a class="code" href="class_string.html" title="ECMAScript String type.">String</a>( <span class="stringliteral">"Point4(%1, %2, %3, %4)"</span> ).arg( x ).arg( y ).arg( z ).arg( <span class="keyword">this</span>.w );
    }

    Point4.superclass = Point3;
</pre></div><h2><a class="anchor" name="scriptConst">
Const:</a></h2>
In DAZ Script 1, variables could be declared as 'const' (constant) meaning that their value could not be changed after declaration. If an attempt was made to change a const variable after declaration the interpreter would throw an error and the script would fail. This has changed in DAZ Script 2 - the 'const' keyword is no longer officially supported (as it is merely a reserved keyword in the ECMAScript 3.0 standard), a variable declared to be 'const' will still not allow itself to be changed, but attempting to do so will not cause the interpreter to throw an error and the script will not fail. We recommend replacing the 'const' specifier from any variable declarations with the <a class="el" href="dsdeclarations.html#var">var</a> specifier.<h2><a class="anchor" name="scriptStatic">
Static:</a></h2>
In DAZ Script 1, class member variables could be declared as 'static' meaning that all instances of the class shared one copy of that variable, instead of each instance having its own variable. <div class="fragment"><pre class="fragment">    <span class="keyword">class </span>Point3
    {
        <span class="keyword">static</span> var count = 0;
    }

    var point = <span class="keyword">new</span> Point3;
    <a class="code" href="group___globals.html#g8cd0559812edfbecc263b823bef26a4a">print</a>( Point3.count );
    <a class="code" href="group___globals.html#g8cd0559812edfbecc263b823bef26a4a">print</a>( point.count );
</pre></div><p>
In DAZ Script 2, the equivalent of this is to assign variables that were static members to properties of the constructor function. <div class="fragment"><pre class="fragment">    function Point3 ()
    {
        <span class="comment">//...;</span>
    }

    Point3.count = 0;

    var point = <span class="keyword">new</span> Point3;
    <a class="code" href="group___globals.html#gfa67d3825f77e2cd3f25a403c3a95a18">debug</a>( Point3.count );
    <a class="code" href="group___globals.html#gfa67d3825f77e2cd3f25a403c3a95a18">debug</a>( point.count );
</pre></div><p>
Note that in DAZ Script 1, static members were accessible from an instance of a given class as well as the class itself. In DAZ Script 2, the variable is a member of the constructor object only, and thereby only accessible from the constructor. <hr size="1">
<address style="align: right;">
<small> Generated on Thu Sep 24 12:21:06 2009</small>
</address>
<h3 align="center">Copyright &copy; 2002 - 2009 DAZ 3D, Inc.</h3>
</body>
</html>
